<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manual - DB - Hibernate / ORM</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="../estilos/manual.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="../index.html">Manual de Desarrollo</a>
        </div>
    </nav>
    <div class="page-wrapper container-fluid">
        <div class="row">
            <aside class="col-md-3 sidenav">
                <div class="accordion accordion-flush sidebar-accordion" id="sidebarAccordion">
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingFrontend">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFrontend" aria-expanded="false" aria-controls="collapseFrontend">Frontend</button>
                        </h2>
                        <div id="collapseFrontend" class="accordion-collapse collapse" aria-labelledby="headingFrontend" data-bs-parent="#sidebarAccordion">
                            <div class="accordion-body">
                                <a href="frontend-html.html">HTML</a>
                                <a href="frontend-css.html">CSS</a>
                                <a href="frontend-bootstrap.html">Bootstrap</a>
                                <a href="frontend-jsp.html">JSP</a>
                                <a href="frontend-jsf.html">JSF</a>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingBackend">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseBackend" aria-expanded="false" aria-controls="collapseBackend">Backend</button>
                        </h2>
                        <div id="collapseBackend" class="accordion-collapse collapse" aria-labelledby="headingBackend" data-bs-parent="#sidebarAccordion">
                            <div class="accordion-body">
                                <a href="backend-maven.html">Maven y pom.xml</a>
                                <a href="backend-servlet.html">Servlets</a>
                                <a href="backend-dao.html">Patrón DAO</a>
                                <a href="backend-ejb.html">EJB</a>
                            </div>
                        </div>
                    </div>
                    <div class="accordion-item">
                        <h2 class="accordion-header" id="headingDb">
                            <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseDb" aria-expanded="true" aria-controls="collapseDb">DB / Persistencia</button>
                        </h2>
                        <div id="collapseDb" class="accordion-collapse collapse show" aria-labelledby="headingDb" data-bs-parent="#sidebarAccordion">
                            <div class="accordion-body">
                                <a href="db-jpa.html">JPA</a>
                                <a href="db-persistence.html">persistence.xml</a>
                                <a href="db-jndi-jdbc.html">JNDI / JDBC</a>
                                <a href="db-hibernate.html" class="active">Hibernate / ORM</a>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>
            <main class="col-md-9 content">
                <h1>Hibernate / ORM</h1>
                <div class="mb-4">
                    <h2>Teoría</h2>
                    <p><strong>Hibernate</strong> es un framework de Mapeo Objeto-Relacional (ORM) para Java. Actúa como una capa de abstracción entre la aplicación y la base de datos, lo que permite al desarrollador trabajar con objetos Java familiares en lugar de escribir código SQL y JDBC directamente.</p>
                    <p>Mientras que JPA es la especificación (el "qué se debe hacer"), Hibernate es una de las implementaciones más populares y robustas (el "cómo se hace"). Hibernate se encarga de traducir las operaciones sobre objetos (como guardar un objeto <code>Producto</code>) en las sentencias SQL correspondientes (<code>INSERT INTO productos...</code>) y viceversa.</p>
                    
                    <div class="placeholder-box my-3">
                        <div class="text-center p-4 bg-light border">
                            <img src="../imagenes/DB/DiagramaORM.jpeg" class="img-fluid mx-auto d-block"
                                alt="Diagrama ORM">
                        </div>
                    </div>
                    
                    <h3>Conceptos Fundamentales de Hibernate</h3>
                    <ul>
                        <li><strong>ORM (Mapeo Objeto-Relacional):</strong> Es la técnica principal que permite "mapear" o conectar una clase de Java a una tabla de la base de datos, y los atributos de la clase a las columnas de la tabla.</li>
                        <li><strong>Session (Sesión):</strong> Es la interfaz principal de Hibernate para interactuar con la base de datos. Es similar al <code>EntityManager</code> de JPA y se utiliza para guardar, actualizar, eliminar y consultar objetos.</li>
                        <li><strong>Relaciones:</strong> Hibernate sobresale en la gestión de relaciones entre entidades, como <code>@OneToOne</code>, <code>@OneToMany</code> y <code>@ManyToMany</code>, simplificando operaciones complejas.</li>
                        <li><strong>HQL (Hibernate Query Language):</strong> Es un lenguaje de consulta orientado a objetos, muy similar a SQL, pero que opera sobre las entidades y sus atributos en lugar de tablas y columnas. Es el superconjunto de JPQL (el lenguaje estándar de JPA).</li>
                        <li><strong>Carga Perezosa (Lazy Loading):</strong> Por defecto, para mejorar el rendimiento, Hibernate no carga las entidades relacionadas (por ejemplo, la lista de libros de un autor) hasta que no se acceden explícitamente.</li>
                    </ul>
                </div>

                <hr>

                <div class="mb-4">
                    <h2>Práctica: Entidades con Relaciones</h2>
                    <p>Un ejemplo más potente que una entidad simple es modelar una relación del mundo real, como un Autor que tiene muchos Libros. Esto se conoce como una relación "Uno a Muchos".</p>

                    <div class="placeholder-box my-3">
                        <div class="text-center p-4 bg-light border">
                            <img src="../imagenes/DB/DiagramaRelaciones.jpeg" class="img-fluid mx-auto d-block"
                                alt="Diagrama Relaciones">
                        </div>
                    </div>

                    <h3>1. Entidad "Autor" (El "Uno")</h3>
                    <p>Esta clase representa la tabla de autores. La anotación <code>@OneToMany</code> indica que un autor puede estar asociado con una colección de libros.</p>
                    <ul>
                        <li><code>mappedBy="autor"</code>: Es crucial. Indica que la relación es gestionada por el campo "autor" en la clase <code>Libro</code>.</li>
                        <li><code>cascade = CascadeType.ALL</code>: Significa que cualquier operación (guardar, eliminar) sobre un Autor se propagará a los Libros asociados.</li>
                    </ul>

                    <pre class="code-block"><code>@Entity
@Table(name = "autores")
public class Autor {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String nombre;
    private String nacionalidad;

    @OneToMany(mappedBy = "autor", cascade = CascadeType.ALL)
    private List<Libro> libros = new ArrayList<>();
}</code></pre>

                    <h3>2. Entidad "Libro" (El "Muchos")</h3>
                    <p>Esta clase representa la tabla de libros. La anotación <code>@ManyToOne</code> indica que muchos libros pueden pertenecer a un solo autor.</p>
                    <ul>
                        <li><code>@JoinColumn(name = "autor_id")</code>: Especifica que en la tabla "libros" habrá una columna de clave foránea llamada "autor_id" para vincularla con la tabla "autores".</li>
                    </ul>

                    <pre class="code-block"><code>@Entity
@Table(name = "libros")
public class Libro {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    private String titulo;

    @ManyToOne
    @JoinColumn(name = "autor_id")
    private Autor autor;
}</code></pre>
                </div>

                <hr>

                <div>
                    <h2>Ejemplos de Uso</h2>
                    <p>Con las entidades definidas, Hibernate simplifica enormemente el trabajo con los datos relacionados.</p>

                    <h3>1. Guardar un Autor con sus Libros</h3>
                    <p>Gracias al uso de <code>CascadeType.ALL</code>, solo necesitamos persistir el objeto <code>Autor</code>. Hibernate se encargará automáticamente de guardar también los objetos <code>Libro</code> asociados y de establecer la clave foránea correcta.</p>

                    <pre class="code-block"><code>Autor autor = new Autor();
autor.setNombre("Gabriel García Márquez");
autor.setNacionalidad("Colombiano");

Libro libro1 = new Libro();
libro1.setTitulo("Cien años de soledad");
libro1.setAutor(autor);

Libro libro2 = new Libro();
libro2.setTitulo("El amor en los tiempos del cólera");
libro2.setAutor(autor);

autor.getLibros().add(libro1);
autor.getLibros().add(libro2);

entityManager.persist(autor);</code></pre>

                    <h3>2. Consultar un Autor y sus Libros</h3>
                    <p>Al consultar un autor, Hibernate nos devuelve el objeto completo. Cuando accedemos a la lista de libros, Hibernate (usando Lazy Loading) ejecutará la consulta necesaria para traerlos de la base de datos en ese momento.</p>

                    <pre class="code-block"><code>Autor autorEncontrado = entityManager.find(Autor.class, 1L);

System.out.println("Autor: " + autorEncontrado.getNombre());

System.out.println("Libros publicados:");
for (Libro libro : autorEncontrado.getLibros()) {
    System.out.println("- " + libro.getTitulo());
}</code></pre>
                </div>
            </main>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>